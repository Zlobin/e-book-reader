var JEZ=function(a,b,c,d){"use strict";return{keys:{ENTER:13,ESCAPE:27,SPACE:32,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,ZERO:48,NINE:57},__:function(a){var b=c[a]||{};return function(a){return b[a]||a}},inherits:function(b,c){var e=function(){return d};a.Object.create?b.prototype=a.Object.create(c.prototype):(e.prototype=c.prototype,b.prototype=new e,b.prototype.constructor=b,b.super_=c.prototype)},extend:function(a,b){var c,d,e=arguments.length;if(e>2)for(d=1;e>d;d++)this.extend(a,arguments[d]);else for(c in b)this.hop.call(b,c)&&(a[c]=b[c]);return a},noop:function(){return d},dom:function(c,e){c=c||null,e=e||b;var f=this,g={el:c,parent:e,on:function(a,b,c){c=c||!1;var d=b,e=this.el;return c!==!1&&(d=function(a){return b(a,c)}),null!==e&&(e.addEventListener?e.addEventListener(a,d,!1):e.attachEvent("on"+a,d)),this},off:function(a,b){var c=this.el;return null!==c&&(c.removeEventListener?c.removeEventListener(a,b,!1):c.detachEvent("on"+a,b)),this},trigger:function(a,b){var c,d,e=this.el,f=this.parent;if(f.createEvent)c=f.createEvent("Events"),c.initEvent(a,!0,!1);else{if(!f.createEventObject)return!1;c=f.createEventObject()}return c.data=b,e.dispatchEvent?d=e.dispatchEvent(c):e.fireEvent&&(d=e.fireEvent("on"+a,c)),d},set:function(a,b){var c,d=this.el;if("style"===a)for(c in b)f.hop.call(b,c)&&(d.style[c]=b[c]);else d.setAttribute(a,b);return this},html:function(a){return a===d?this.el.innerHTML:(this.el.innerHTML=a,this)},get:function(b,c){var d,e=this.el;return"style"===b?(d=e.currentStyle||a.getComputedStyle(e,null),d[c]):e.getAttribute(b)},del:function(a){return this.el.removeAttribute(a),this},data:function(a,b){var c="data-",d=c+a,e=!1;return 2===arguments.length?e=this.get(d):3===arguments.length&&(""===a?this.del(d):this.set(d,b),e=!0),e},create:function(a){a=a||{};var b,c=this.parent.createElement(this.el);for(b in a)f.hop.call(a,b)&&(c[b]=a[b]);return c},remove:function(){var a=this.el;return a.parentNode&&a.parentNode.removeChild(a),this},append:function(a){return this.el.appendChild(a),this},find:function(a,b){e=this.parent,a=a===d?!0:!1;var c=null,f=this.el;return c="#"===f.charAt(0)?e.getElementById(f.substr(1)):b?e.querySelectorAll(f):e.querySelector(f),a?(this.el=c,this):c},hasClass:function(a){var b=this.el;return f.support_class_list?b.classList.contains(a):new RegExp("(^| )"+a+"( |$)","gi").test(b.className)},addClass:function(a){var b=this.el;return this.hasClass(a)||(f.support_class_list?b.classList.add(a):b.className+=" "+a),this},removeClass:function(a){var b=this.el;return this.hasClass(a)&&(f.support_class_list?b.classList.remove(a):b.className=b.className.replace(new RegExp("(\\s|^)"+a+"(\\s|$)")," ")),this},toggleClass:function(a){return this.hasClass(a)?this.removeClass(a):this.addClass(a),this},parents:function(){return this.el.parentNode},children:function(){return this.el.childNodes}};return g},modal:function(a,c){c=c||"";var d,e=this.dom("#JEZ_modal").find(!1),f=['<span class="JEZ_modal_close icon-cancel" id="JEZ_modal_close"></span>',"<h3>"+c+"</h3>",'<div class="JEZ_modal_content">',a,"</div>"];return null===e&&(e=this.dom("div").create({id:"JEZ_modal",className:"JEZ_modal fade"}),this.dom(b.body).append(e)),d=this.dom(e),d.html(f.join("")),{show:function(){d.addClass("show")},hide:function(){d.removeClass("show")}}},touchScrolling:function(a){var b=0,c=this.dom(a);return c.on("touchstart",function(a){b=this.el.scrollTop+a.touches[0].pageY,a.preventDefault()}).on("touchmove",function(a){this.el.scrollTop=b-a.touches[0].pageY,a.preventDefault()}),this},fullScreen:{is:function(){return b.webkitIsFullScreen||b.mozFullScreen||b.msFullScreen||b.fullScreen?!0:!1},request:function(a){if(a.requestFullScreen)a.requestFullScreen();else if(a.webkitRequestFullScreen)a.webkitRequestFullScreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();else{if(!a.msRequestFullScreen)return!1;a.msRequestFullScreen()}return!0},exit:function(a){if(a.requestFullScreen)b.cancelFullScreen();else if(a.webkitRequestFullScreen)b.webkitCancelFullScreen();else if(a.mozRequestFullScreen)b.mozCancelFullScreen();else{if(!a.msExitFullScreen)return!1;b.msExitFullScreen()}return!0}},storage:{prefix:"jez_",isSupport:function(){return a.localStorage!==d},set:function(b,c){return this.isSupport&&a.localStorage.setItem(this.prefix+b,JSON.stringify(c)),this},get:function(b,c){var d;return this.isSupport&&(d=a.localStorage.getItem(this.prefix+b)),this.isSupport&&d?JSON.parse(d):c},remove:function(b){return this.isSupport&&a.localStorage.removeItem(this.prefix+b),this},clear:function(){return this.isSupport&&a.localStorage.clear(),this}},getXHR:function(){var b=!1;return a.XMLHttpRequest.prototype.hasOwnProperty("withCredentials")?b=new a.XMLHttpRequest:a.XDomainRequest!==d&&(b=new a.XDomainRequest),b},isCurrentHost:function(b){return-1!==b.indexOf(a.location.hostname)?!0:!1},vendors:["","ms","moz","webkit","o"],support_xhr:!(a.XMLHttpRequest.prototype.hasOwnProperty("withCredentials")&&a.XDomainRequest!==d),support_class_list:b.documentElement.classList!==d,is_mobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(a.navigator.userAgent),click_event:function(){return this.is_mobile?"touchstart":"click"},hop:Object.prototype.hasOwnProperty}}(this,this.document,this.JEZ_locale||[]),ImageLoader=function(a,b,c){"use strict";return function(d,e,f,g){this.status="ready",this.loader=c,e=e||b.noop,f=f||b.noop,g=g||b.noop;var h=function(a){this.status="done",e(a)}.bind(this),i=function(a){this.status="error",f(a)}.bind(this),j=function(a){g(a)}.bind(this);return this.XHRLoader=function(){var c=b.getXHR();return b.dom(c).on("load",function(){return 200!==this.status||4!==this.readyState?void i(this):void h(this)}).on("progress",function(a){a.lengthComputable&&j(Math.round(a.loaded/a.total*100))}),c.open("GET",d,!0),c.responseType="blob",c.timeout=5e4,{start:function(){c.send(),a.setTimeout(function(){3===c.readyState&&c.abort()},c.timeout)},stop:function(){c.abort()},destroy:function(){c.abort()}}},this.DOMLoader=function(){var e=b.dom(b.dom("img").create());return{start:function(){var b=!1,f=function(a){b||(b=!0,i(a))};e.on("load",function(b){var e=b.target;a.URL.revokeObjectURL(d),e.naturalWidth!==c&&0!==e.naturalWidth&&e.complete?h(b):f(b)},this).on("error",function(a){f(a)},this).set("src",d)},stop:function(){e.set("src","")},destroy:function(){e.set("src","")}}},this.loader=b.support_xhr&&b.isCurrentHost(d)?new this.XHRLoader:new this.DOMLoader,{start:function(){return this.loader.start(),this.status="progress",this}.bind(this),stop:function(){return this.loader.stop(),this.status="stopped",this}.bind(this),destroy:function(){return this.stop(),this.loader.destroy(),this.status="destroyed",this}.bind(this)}}}(this,this.JEZ);!function(a){"use strict";a["en-us"]={"Single Page":"Single Page","Dual Page":"Dual Page",thumbnails:"thumbnails",Invert:"Invert","First page":"First page","Previous page":"Previous page","Next page":"Next page","Last page":"Last page","Turn left":"Turn left","Turn right":"Turn right",Print:"Print","Zoom in":"Zoom in","Zoom out":"Zoom out","Full Screen":"Full Screen","Search text":"Search text","Printing options":"Printing options","All pages":"All pages","Current page":"Current page",from:"from",to:"to","Paper size":"Paper size",A4:"A4",Letter:"Letter","Send to print":"Send to print","Loading. Please wait":"Loading. Please wait...",Printout:"Printout"}}(this.JEZ_locale||[]),function(a){"use strict";a["ru-ru"]={"Single Page":"Одностраничный режим","Dual Page":"Двухстраничный режим",thumbnails:"Миниатюры",Invert:"Инвертировать цвета","First page":"Первая страница","Previous page":"Предыдущая страница","Next page":"Следующая страница","Last page":"Последняя страница","Turn left":"Повернуть налево","Turn right":"Повернуть направо",Print:"Печать","Zoom in":"Увеличить","Zoom out":"Уменьшить","Full Screen":"Полноэкранный режим","Search text":"Поиск","Printing options":"Опции печати","All pages":"Все страницы","Current page":"Текущая страница",from:"с",to:"по","Paper size":"Размер бумаги",A4:"A4",Letter:"Письмо","Send to print":"На печать","Loading. Please wait":"Загрузка. Пожалуйста, подождите",Printout:"Вывод на печать"}}(this.JEZ_locale||[]),function(a){"use strict";var b,c=a.JEZ,d={options:{},params:{},consts:{},root_element:""};b=function(a){var e,f,g,h=function(a){var c;if("image"===a)c=new b.ImageReader;else{if("html"!==a)throw new Error('Mode "'+e.default_screen_mode+'" does not exist');c=new b.HTMLReader}return c};if(this.VERSION="@@VERSION",this.reader=null,this.defaults={root_element_ID:"EBookReader",reader_module:"image",default_screen_mode:"single",start_page:1,search_URL:"",book_ID:0,auto_height:!0,thumbnails_images:[],thumbnails_width:150,thumbnails_images_preload:!0,images:{},images_preload:!0,chapters:{},enable_chapters:!1,enable_search:!1,enable_print:!0,enable_sidebar:!1,sidebar_info:{},enable_DNS_prefetch:!0,CDN_host:"site.com",locale:"en-us",direction:"ltr",screen_mode_params:{single:{autofit:"width",percent:"100",onLoadImage:c.noop,padding:{top:10,right:10,bottom:10,left:10}},dual:{autofit:"height",percent:"100",onLoadImage:c.noop}},onChangePage:c.noop,onBeforeLoad:c.noop,onAfterLoad:c.noop},d.options=c.extend(this.defaults,a),e=d.options,f=e.root_element_ID,delete this.defaults,d.consts={TYPE_PARTLYREPLACE:"partly_replace",TYPE_FULLREPLACE:"full_replace",SINGLE_MODE:"single",DUAL_MODE:"dual"},d.root_element=c.dom("#"+f).find(!1),g=d.root_element,null===g)throw new Error("Root Element with ID "+f+" does not exist");e.onBeforeLoad(),c.dom(g).html(""),this.reader=new h(e.reader_module),e.onAfterLoad()},a.EBookReader=b,a.EBRParams=d}(this),function(a,b){"use strict";var c,d,e,f,g=a.EBookReader,h=a.JEZ,i=a.EBRParams;g.Reader=function(){var a=i.options;this.setSettings_().parseURLHash_().setLocale_(),a.enable_DNS_prefetch&&""!==a.CDN_host&&this.setupDNSPrefetch_()},c=g.Reader.prototype,c.setSettings_=function(){var a=i.options;return i.params={storage_hash:(a.book_ID>>0)+"_",set_screen_mode:a.default_screen_mode,enable_chapters:a.enable_chapters,enable_sidebar:a.enable_sidebar,enable_search:a.enable_search,enable_print:a.enable_print,print_popup:!1,current_page:a.start_page,enable_fullscreen:!1,enable_thumbnails:!1,enable_invert:!1,search_string:"",page_height:null,page_width:null,current_angle:0,current_zoom:1,number_pages:null,current_screen_mode:null,loaded_images:{img:[],page:[]}},this},c.setLocale_=function(){return h.dom("html").find().set("lang",i.options.locale),this},c.parseURLHash_=function(){var c,d,e,f,g,h,j=a.location.hash,k=i.params;if(""!==j){for(d=j.split("/"),h=1,f=d.length;f>h;h+=2)if(e=d[h],c=d[h+1],c!==b)switch(e){case"page":i.params.current_page=c>>0;break;case"mode":i.params.set_screen_mode=c.toString();break;case"print":i.params.enable_print=!!(c>>0);break;case"print_popup":i.params.print_popup=!!(c>>0);break;case"thumbnails":i.params.enable_thumbnails=!!(c>>0);break;case"fullscreen":i.params.enable_fullscreen=!!(c>>0);break;case"search":i.params.enable_search=!!(c>>0);break;case"invert":i.params.enable_invert=!!(c>>0);break;case"chapters":i.params.enable_chapters=!!(c>>0);break;case"sidebar":i.params.enable_sidebar=!!(c>>0);break;case"angle":i.params.current_angle=c>>0;break;case"zoom":i.params.current_zoom=parseFloat(c.toString().replace(/\_/g,"."));break;case"search_string":i.params.search_string=c}}else g=["#!","page",k.current_page>>0,"mode",k.set_screen_mode,"print",k.enable_print>>0,"print_popup",k.print_popup>>0,"thumbnails",k.enable_thumbnails>>0,"fullscreen",k.enable_fullscreen>>0,"sidebar",k.enable_sidebar>>0,"chapters",k.enable_chapters>>0,"search",k.enable_search>>0,"invert",k.enable_invert>>0,"angle",k.current_angle>>0,"zoom",k.current_zoom.toString().replace(/\./g,"_"),"search_string",k.search_string],this.updateURLHash(g);return i.params.number_pages=i.options.images[k.set_screen_mode].length,this},c.updateURLHash=function(b,c){var d,e,f=a.location.hash,g=i.consts;return c=c||g.TYPE_FULLREPLACE,c===g.TYPE_FULLREPLACE?a.location.hash=b.join("/"):c===g.TYPE_PARTLYREPLACE&&(e=new RegExp("/"+b.name+"/\\w+/","i"),""!==f&&(d=f.replace(e,"/"+b.name+"/"+b.value+"/"),d!==f&&(a.location.hash=d))),this},c.setupDNSPrefetch_=function(){var a=h.dom("meta").create({httpEquiv:"x-dns-prefetch-control",content:"on"}),b=h.dom("link").create({rel:"dns-prefetch",href:"//"+i.options.CDN_host}),c=h.dom("head").find();return c.append(b).append(a),this},c.firstPage=function(){return this.gotoPage(1),this},c.invert=h.noop,c.lastPage=function(){return this.gotoPage(i.params.number_pages),this},c.nextPage=function(){return this.gotoPage(i.params.current_page+1),this},c.previousPage=function(){return this.gotoPage(i.params.current_page-1),this},c.gotoPage=h.noop,g.Reader.ScreenMode=h.noop,d=g.Reader.ScreenMode.prototype,d.zoom=h.noop,d.turn=h.noop,d.loadPage=h.noop,g.Reader.ScreenMode.Single=h.noop,h.inherits(g.Reader.ScreenMode.Single,g.Reader.ScreenMode),e=g.Reader.ScreenMode.Single.prototype,e.thumbnails=h.noop,e.updateScrollByPage=h.noop,g.Reader.ScreenMode.Dual=h.noop,h.inherits(g.Reader.ScreenMode.Dual,g.Reader.ScreenMode),f=g.Reader.ScreenMode.Dual.prototype,f.leafLeft=h.noop,f.leafRight=h.noop}(this),function(a,b){"use strict";var c,d,e=a.EBRParams,f=a.EBookReader,g=a.JEZ,h=a.document;f.ImageReader=function(){f.Reader.call(this);var a=e.params,b=g.storage,c=e.options;this.IMAGE_TYPE_PRINT_LETTER="print_letter",this.IMAGE_TYPE_PRINT_A4="print_a4",this.IMAGE_TYPE_SINGLE="single",this.IMAGE_TYPE_DUAL="dual",this.toolbar_paginator={},this.print_wrapper={},this.sm_container={},this.screen_mode={},this.page_view={},this.thumbnails={},this.wrapper={},this.toolbar={},d=g.__(c.locale),e.params.hash_images_sizes=a.storage_hash+"images_sizes",e.params.image_sizes=b.get(a.hash_images_sizes,!1),e.params.image_sizes=a.image_sizes||{single:{width:null,height:null},dual:{width:null,height:null}},this.initFullScreenHandler_().createWrapper_().initToolbar_().initToolbarPagination_().createThumbnails_().createPageView_().createScreenModeContainer_().changeScreenMode_(a.set_screen_mode).initEvents_().setupResizeEvent_().setupKeyListener_().render_(),e.params.page_height=b.get(this.getHash_()+"_height",null),e.params.page_width=b.get(this.getHash_()+"_width",null),this.changeStateScreenModeButtons_().gotoPage(a.current_page),g.is_mobile&&this.addMobileFeatures_()},g.inherits(f.ImageReader,f.Reader),c=f.ImageReader.prototype,c.initEvents_=function(){var a=e.options;return this.initToolbarPaginationEvents_().initToolbarButtons_().initToolbarVisibility_().initScrollEvent_().initMouseWheelEvent_().initURLEvents_(),a.enable_chapters&&this.initToolbarChapters_(),a.enable_search&&this.initToolbarSearch_(),a.enable_print&&this.initToolbarPrint_(),this},c.initURLEvents_=function(){var a=e.consts;return g.dom(e.root_element).on("change:url:partly",function(b){this.updateURLHash({name:b.data.name,value:b.data.value},a.TYPE_PARTLYREPLACE)}.bind(this)).on("change:url:full",function(b){this.updateURLHash({name:b.data.name,value:b.data.value},a.TYPE_FULLREPLACE)}.bind(this)),this},c.initScrollEvent_=function(){var a=e.params,b=e.consts.SINGLE_MODE;return g.dom(this.page_view).on("scroll",function(c,d){var e,f,h=g.dom(c.target);a.current_screen_mode!==b||h.data("disable_scroll")?h.data("disable_scroll",!1):(e=d.screen_mode.getPageByScroll(d.page_view),f=a.current_page,f!==e&&d.gotoPage(e,"by_scroll"))},this),this},c.initMouseWheelEvent_=function(){return this},c.getHash_=function(){var a=e.params,b=a.storage_hash,c=e.consts,d=a.current_screen_mode;return d===c.SINGLE_MODE?b+=this.IMAGE_TYPE_SINGLE:d===c.DUAL_MODE&&(b+=this.IMAGE_TYPE_DUAL),b},c.createWrapper_=function(){return this.wrapper=g.dom("div").create({className:"EBR_wrapper",id:"EBR_wrapper"}),this},c.initToolbar_=function(){return this.toolbar=g.dom("div").create({className:"EBR_toolbar",id:"EBR_toolbar"}),g.dom(this.wrapper).append(this.toolbar),this},c.initToolbarVisibility_=function(){var a=g.dom(this.toolbar);return a.on("mouseover",function(b,c){b=b||{},a.removeClass("hide"),c.screen_mode.recalculateSizes()},this).on("mouseout",function(b,c){b=b||{},a.addClass("hide"),c.screen_mode.recalculateSizes()},this),this},c.initToolbarButtons_=function(){var a,c,f,h=[],i=e.params,j=g.dom("div").create({className:"EBR_buttons_wrapper",id:"EBR_buttons_wrapper"}),k=g.dom(j),l={single_screen_mode:{enable:!1,title:d("Single Page"),icon:"doc-text",events:{click:function(a,b){a.preventDefault(),b.changeScreenMode_(i.SINGLE_MODE)}}},dual_screen_mode:{enable:!1,title:d("Dual Page"),icon:"book-open",events:{click:function(a,b){a.preventDefault(),b.changeScreenMode_(i.DUAL_MODE)}}},thumbnails:{title:d("thumbnails"),icon:"th-list",events:{click:function(a,b){a.preventDefault();var c=i.enable_thumbnails?"off":"on";b.thumbnailsBlock(c)}}},invert:{title:d("Invert"),icon:"adjust-1",events:{click:function(a,b){a.preventDefault();var c=i.enable_invert?"off":"on";b.invert(c)}}},first_page:{title:d("First page"),icon:"backward",events:{click:function(a,b){a.preventDefault(),b.firstPage()}}},previous_page:{title:d("Previous page"),icon:"reply",events:{click:function(a,b){a.preventDefault(),b.previousPage()}}},next_page:{title:d("Next page"),icon:"forward",events:{click:function(a,b){a.preventDefault(),b.nextPage()}}},last_page:{title:d("Last page"),icon:"forward-1",events:{click:function(a,b){a.preventDefault(),b.lastPage()}}},turn_left:{title:d("Turn left"),icon:"ccw",events:{click:function(a,b){a.preventDefault(),b.screen_mode.turn("left")}}},turn_right:{title:d("Turn right"),icon:"cw",events:{click:function(a,b){a.preventDefault(),b.screen_mode.turn("right")}}},print:{title:d("Print"),icon:"print",events:{click:function(a,b){a.preventDefault();var c=i.print_popup?"off":"on";b.print(c)}}},zoom_in:{title:d("Zoom in"),icon:"zoom-in",events:{click:function(a,b){a.preventDefault(),b.screen_mode.zoom("in")}}},zoom_out:{title:d("Zoom out"),icon:"zoom-out",events:{click:function(a,b){a.preventDefault(),b.screen_mode.zoom("out")}}},fullscreen:{title:d("Full Screen"),icon:"resize-full-alt",events:{click:function(a,b){a.preventDefault();var c=i.enable_fullscreen?"off":"on";b.fullScreen(c)}}}};for(c in l)g.hop.call(l,c)&&l[c].enable!==!1&&(f=g.dom("button").create({id:"EBR_button_"+c,className:"EBR_button"}),l[c].icon&&g.dom(f).addClass("icon-"+l[c].icon),f.title=l[c].title,l[c].events!==b&&this.initToolbarButtonEvents_(f,"click"===l[c].events?g.click_event():l[c].events),h.push(f));for(a in h)g.hop.call(h,a)&&k.append(h[a]);return g.dom(this.toolbar).append(j),this},c.initToolbarButtonEvents_=function(a,b){var c,d=g.dom(a);for(c in b)g.hop.call(b,c)&&d.on(c,b[c],this);return this},c.thumbnailsBlock=function(a){return"on"===a?this.showThumbnails_():this.hideThumbnails_(),e.params.enable_thumbnails=!e.params.enable_thumbnails,this.updateURLHash({name:"thumbnails",value:e.params.enable_thumbnails?1:0},e.consts.TYPE_PARTLYREPLACE),this},c.createThumbnails_=function(){return this.thumbnails=g.dom("div").create({className:"EBR_thumbnails",id:"EBR_thumbnails"}),g.dom(this.wrapper).append(this.thumbnails),this},c.showThumbnails_=function(){var a,b,c=e.options,d=c.thumbnails_images,f=d.length;for(g.dom(this.thumbnails).set("style",{display:"block",width:c.thumbnails_width+30+"px",height:g.dom(this.page_view).get("style","height")}),a=0;f>a;a++)b=this.addThumbnail_(d[a],a),g.dom(this.thumbnails).append(b);return this},c.addThumbnail_=function(a,b){var c=g.dom("div").create({className:"EBR_thumbnails_wrapper"}),d=g.dom("img").create({id:"EBRthumbnail_"+b,className:"EBR_thumbnail_img",src:a});return g.dom(d).set("style",{width:e.options.thumbnails_width+"px"}).on("click",function(a,c){a.preventDefault();var d=g.dom(".EBR_thumbnail_img.active").find();null!==d.el&&d.removeClass("active"),g.dom(a.target).addClass("active"),c.gotoPage(b+1)},this),g.dom(c).append(d),c},c.hideThumbnails_=function(){return g.dom(this.thumbnails).set("style",{display:"none"}),this},c.setupResizeEvent_=function(){return a.onresize=function(){this.screen_mode.recalculateSizes()}.bind(this),this},c.setupKeyListener_=function(){return g.dom(h).on("keydown",function(a,b){var c=g.keys;switch(a.keyCode){case c.LEFT:b.previousPage();break;case c.RIGHT:b.nextPage();break;case c.HOME:b.firstPage();break;case c.END:b.lastPage()}},this),g.dom(this.sm_container).on("contextmenu",function(a){a.preventDefault()}),this},c.initToolbarSearch_=function(){var a=g.dom("div").create({className:"EBR_search_wrapper",id:"EBR_search_wrapper"}),b=g.dom("form").create({id:"EBR_search_form"}),c=g.dom("input").create({id:"EBR_search_button",className:"EBR_search_button"}),e=g.dom("input").create({id:"EBR_search_text",className:"EBR_search_text",autocomplete:"on",spellcheck:"true",autocorrect:"off",required:"required",placeholder:d("Search text"),"x-webkit-speech":""});return g.dom(b).append(e).append(c),g.dom(a).append(b),g.dom(this.toolbar).append(a),this},c.initToolbarPagination_=function(){var a=g.dom("div").create({className:"EBR_pagination_wrapper",id:"EBR_pagination_wrapper"}),b=g.dom("div").create({id:"EBR_pagination_form"});return this.toolbar_paginator=g.dom("input").create({className:"EBR_pagination_input",name:"EBR_pagination_input",id:"EBR_pagination_input",value:e.params.current_page,type:"text"}),g.dom(b).append(this.toolbar_paginator),g.dom(a).append(b),g.dom(this.toolbar).append(a),this},c.initToolbarPaginationEvents_=function(){return g.dom(this.toolbar_paginator).on("keypress",function(a){(a.keyCode<g.keys.ZERO||a.keyCode>g.keys.NINE)&&a.preventDefault()}).on("keyup",function(a,b){var c=a.target,d=parseInt(c.value,10)>>0;1>d?a.target.value=1:d>b.number_pages&&(a.target.value=b.number_pages),b.gotoPage(c.value)},this),this},c.printForm_=function(){var a=e.params,b='input type="radio" class="EBR_print_selector" name="EBR_print_range"',c='input type="radio" class="EBR_paper_type" name="EBR_paper_size"',f='input type="text" class="EBR_print_pages" ',g=['<form class="EBR_print_form">','<div class="EBR_printing_page_options">','  <div class="EBR_print_title">'+d("Printing options")+":</div>",'  <label for="EBR_print_all">',"    <"+b+' value="all" id="EBR_print_all" checked="checked">',"    "+d("All pages"),"  </label>",'  <label for="EBR_print_current">',"    <"+b+' value="current" id="EBR_print_current">',"    "+d("Current page"),"  </label>",'  <label for="EBR_print_range">',"    <"+b+' value="range" id="EBR_print_range">',"    "+d("from")+" ","  </label>","  <"+f+'name="EBR_print_from" id="EBR_print_from" value="'+a.current_page+'">',"  "+d("to")+" ","  <"+f+'name="EBR_print_to" id="EBR_print_to" value="'+a.number_pages+'">',"</div>",'<div class="EBR_printing_size_options">','  <div class="EBR_print_title">'+d("Paper size")+":</div>",'  <label for="EBR_paper_size_a4">',"    <"+c+' value="a4" id="EBR_paper_size_a4" checked="checked">',"    "+d("A4"),"  </label>",'  <label for="EBR_paper_size_letter">',"    <"+c+' value="letter" id="EBR_paper_size_letter">',"    "+d("Letter"),"  </label>","</div>",'<input type="button" id="EBR_goto_print" value="'+d("Send to print")+'">',"</form>"];return g},c.printPage_=function(a,b){var c=["<!DOCTYPE html>",'<html lang="en">',"<head>",'<meta charset="UTF-8">','<meta http-equiv="X-UA-Compatible" content="IE=edge">',"<style>","@media print {","@page {size:"+a+";margin:20mm 15mm;}","* {-webkit-print-color-adjust:exact;print-color-adjust:exact;}","html {height:100%;}","body {background:none;width:100%;height:100%;margin:0;padding:0;}","div {margin:auto;max-width:100%;max-height:100%;}","img {page-break-inside:avoid;border:0;max-width:100%;max-height:100%;display:block;margin:auto;}","}","</style>","</head>","<body onload=\"document.getElementById('loading').style.display='none'; window.print();\">",'<span id="loading">'+d("Loading. Please wait")+"...</span>","<div>",b.join(""),"</div>","</body>","</html>"];return c},c.initToolbarPrint_=function(){return this.print_wrapper=g.dom("div").create({className:"EBR_print_wrapper",id:"EBR_print_wrapper"}),this.print_wrapper.insertAdjacentHTML("beforeEnd",this.printForm_().join("")),this},c.sendPrint=function(b,c,d){var e,f,g,h=a.open("#","_blank"),i=h.document,j=[];for("a4"===d?e="210mm 297mm":"letter"===d&&(e="215.9mm 279.4mm"),g=b;c>g;g++)f=this.screen_mode.getImage(g),f&&j.push('<img src="'+f+'">');return i.write(this.printPage_(e,j).join("")),i.close(),this},c.initPrintButtonEvents_=function(){return g.dom("#EBR_goto_print").find().on(g.click_event(),function(a,b){var c,d,f=g.dom('input[name="EBR_paper_size"]:checked').find(!1).value,h=g.dom('input[name="EBR_print_range"]:checked').find(!1).value,i=e.params;a.preventDefault(),"all"===h?(c=0,d=i.number_pages):"range"===h?(c=g.dom("#EBR_print_from").find(!1).value>>0,d=g.dom("#EBR_print_to").find(!1).value>>0):c=d=i.current_page,b.sendPrint(c,d,f)},this),this},c.initToolbarChapters_=function(){var a=g.dom("div").create({className:"EBR_chapters_wrapper",id:"EBR_chapters_wrapper"});return g.dom(this.toolbar).append(a),this},c.createPageView_=function(){return this.page_view=g.dom("main").create({className:"EBR_page_view",id:"EBR_page_view"}),g.dom(this.wrapper).append(this.page_view),this},c.createScreenModeContainer_=function(){var a=e.consts.SINGLE_MODE,b="EBR_"+a+"_page_container",c="EBR_"+a+"_page_container EBR_page_container";return e.params.enable_invert&&(c+=" invert"),this.sm_container=g.dom("section").create({id:b,className:c+" no_select"}),g.dom(this.page_view).append(this.sm_container),this},c.render_=function(){var b=g.is_mobile?"mobile":"non_mobile",c=g.dom(e.root_element);return c.addClass(b).append(this.wrapper),e.options.auto_height&&g.dom(this.page_view).set("style",{height:a.innerHeight-this.toolbar.offsetHeight+"px"}),this},c.updateToolbarPaginator=function(a){return this.toolbar_paginator.value=a>>0,this},c.fullScreen=function(a){var b=g.dom("#EBR_button_fullscreen").find(),c=e.root_element,d=function(a){var b=g.dom(c),d=g.dom("#EBR_overlay").find();"on"===a&&null===d.el&&(d=g.dom("div").create({className:"EBR_overlay",id:"EBR_overlay"}),g.dom(h.body).append(d)),b.toggleClass("full_screen")};return"on"===a?(g.fullScreen.request(c)||d(a),b.addClass("icon-resize-small-alt").removeClass("icon-resize-full-alt")):(g.fullScreen.exit(c)||d(a),b.addClass("icon-resize-full-alt").removeClass("icon-resize-small-alt")),e.params.enable_fullscreen=!e.params.enable_fullscreen,this.updateURLHash({name:"fullscreen",value:e.params.enable_fullscreen>>0},e.consts.TYPE_PARTLYREPLACE),this},c.initFullScreenHandler_=function(){var a=function(){g.fullScreen.is()||this.fullScreen("off")}.bind(this);return g.dom(h).on("webkitfullscreenchange",a).on("mozfullscreenchange",a).on("msfullscreenchange",a).on("fullscreenchange",a),this},c.print=function(a){var b,c=g.dom("#EBR_button_print").find(),f=g.dom(this.print_wrapper).html(),h=g.modal(f,d("Printout")),i=e.params.print_popup;return"on"===a?(b=g.dom("#JEZ_modal_close").find(),c.addClass("active"),b.on(g.click_event(),function(){this.print("off")}.bind(this)),h.show(),this.initPrintButtonEvents_()):(c.removeClass("active"),h.hide()),e.params.print_popup=!i,this.updateURLHash({name:"print_popup",value:i?0:1},e.consts.TYPE_PARTLYREPLACE),this},c.changeScreenMode_=function(a){var b=e.consts;if(e.params.current_screen_mode!==a){if(a===b.SINGLE_MODE)this.screen_mode=new f.ImageReader.ScreenMode.Single(this.sm_container,this.page_view,this.toolbar,this.thumbnails);else{if(a!==b.DUAL_MODE)throw new Error('Screen Mode "'+a+'" does not exist');this.screen_mode=new f.ImageReader.ScreenMode.Dual(this.sm_container,this.page_view,this.toolbar,this.thumbnails)}this.updateURLHash({name:"mode",value:a},b.TYPE_PARTLYREPLACE),e.params.current_screen_mode=a,this.changeStateScreenModeButtons_()}return this},c.changeStateScreenModeButtons_=function(){var a=g.dom("#EBR_button_single_screen_mode").find(),b=g.dom("#EBR_button_dual_screen_mode").find(),c=e.consts,d=e.params.current_screen_mode;return d===c.SINGLE_MODE?null!==a.el&&null!==b.el&&(b.removeClass("active"),a.addClass("active")):d===c.DUAL_MODE&&null!==a.el&&null!==b.el&&(a.removeClass("active"),b.addClass("active")),this},c.removeToolbarButtons_=function(a){for(var b=a.length;b--;)g.dom("#"+a[b]).find().remove();return this},c.addMobileFeatures_=function(){return this.removeToolbarButtons_(["EBR_button_thumbnails","EBR_button_zoom_out","EBR_button_zoom_in","EBR_button_fullscreen"]),g.touchScrolling(this.page_view),g.dom(win).on("devicelight",function(a){var b=g.dom(this.wrapper),c=a.value;50>c?b.addClass("dim"):c>=50&&300>=c?b.addClass("normal"):c>300&&b.addClass("bright")}.bind(this)),this},c.invert=function(a){var b=e.params.enable_invert,c=g.dom(this.sm_container);return"on"===a?c.addClass("invert"):c.removeClass("invert"),e.params.enable_invert=!b,this.updateURLHash({name:"invert",value:b?0:1},e.consts.TYPE_PARTLYREPLACE),this},c.gotoPage=function(a,b){b=b||!1;var c=e.params;if(!(a>0&&a<=c.number_pages))throw new Error("Page #"+a+" does not exist");return e.options.onChangePage(),e.params.current_page=a,this.updateToolbarPaginator(c.current_page),this.screen_mode.loadImage(),b||this.screen_mode.updateScrollByPage(this.page_view,c.current_page),this.updateURLHash({name:"page",value:a},e.consts.TYPE_PARTLYREPLACE),this}}(this),function(a){"use strict";var b,c=a.ImageLoader,d=a.EBRParams,e=a.EBookReader,f=a.JEZ;e.ImageReader.ScreenMode=e.ImageReader.ScreenMode||{},e.ImageReader.ScreenMode.Single=function(a,b,c,d){this.sm_container=a,this.page_view=b,this.toolbar=c,this.thumbnails=d},f.inherits(e.ImageReader.ScreenMode.Single,e.Reader.ScreenMode.Single),b=e.ImageReader.ScreenMode.Single.prototype,b.getImage=function(a){var b=d.options.images,c=d.consts.SINGLE_MODE;if(!b[c][a])throw new Error("Image #"+a+" with size type "+c+" does not exist");return b[c][a]},b.updateScrollByPage=function(a,b){var c=(b-1)*d.params.page_height>>0;return a.scrollTop=c,f.dom(a).data("disable_scroll",!0),this},b.zoom=function(a){var b=d.params,c="out"===a?-1:1,e=.2,g=.2,h=2,i=(parseFloat(b.current_zoom)+e*c).toFixed(2);return i>g&&h>i&&(d.params.current_zoom=i,this.recalculateSizes()),f.dom(d.root_element).trigger("change:url:partly",{name:"zoom",value:i.toString().replace(/\./g,"_")}),this},b.scale=function(a,b){return a.set("style",{"-webkit-transform":"scale("+b+")","-moz-transform":"scale("+b+")","-ms-transform":"scale("+b+")","-o-transform":"scale("+b+")",transform:"scale("+b+")"}),this},b.thumbnails=function(){return this},b.turn=function(a){var b="left"===a?-1:1,c=parseInt(d.params.current_angle,10)||0,e=(c+90*b)%360;return 0>e&&(e+=360),d.params.current_angle=e,f.dom(this.sm_container).removeClass("angle_"+c).addClass("angle_"+e),f.dom(d.root_element).trigger("change:url:partly",{name:"angle",value:e}),this.recalculateSizes(),this},b.getPageByScroll=function(a){return(a.scrollTop/d.params.page_height>>0)+1},b.createPage_=function(a,b){var c=f.dom("figure").create({className:"EBR_image_wrapper"}),d=f.dom(this.sm_container);return this.calculateImageSize(a,b),f.dom(a).addClass("EBR_images"),f.dom(c).append(a),d.append(c),this},b.calculateImageSize=function(a,b){var c,e,g,h=d.options.screen_mode_params.single,i=[],j=d.params.page_height*b>>0,k=d.params,l=k.current_zoom,m=this.getSizesAutofit_(h.autofit,"image"),n=f.dom(a),o=a.getBoundingClientRect().width||a.width,p=a.getBoundingClientRect().height||a.height;for(c in h.padding)f.hop.call(h.padding,c)&&i.push(h.padding[c]+"px");return m.margin=i.join(" "),m.top=j+"px",n.set("style",m),1!==l&&(this.scale(n,l),e=parseInt(n.get("style","top"),10)||0,g=parseInt(n.get("style","left"),10)||0,n.set("style",{top:e+(a.getBoundingClientRect().height-p)/2+"px",left:g+(a.getBoundingClientRect().width-o)/2+"px"})),this},b.recalculateSizes=function(){var b=d.params,c=d.options,e=d.consts,g=b.page_height*b.number_pages>>0,h=b.loaded_images,i=h.img,j=h.page,k=i.length,l=b.current_angle,m=f.dom(this.sm_container),n=this.getSizesAutofit_(c.screen_mode_params[e.SINGLE_MODE].autofit,"wrapper");
for(d.params.page_width=n.width,d.params.page_height=n.height,f.dom(this.page_view).set("style",{height:a.innerHeight-this.toolbar.clientHeight-1+"px"}),m.set("style",{height:g+"px"}),0!==l&&m.addClass("angle_"+l);k--;)this.calculateImageSize(i[k],j[k]);return this},b.getSizesAutofit_=function(a,b){var c=d.consts.SINGLE_MODE,e=d.options,f=d.params,g=e.screen_mode_params[c],h=g.percent/100,i=this.page_view,j=i.clientHeight,k=i.clientWidth,l=g.padding,m=l.bottom+l.top,n=l.left+l.right,o=f.image_sizes[c].width,p=f.image_sizes[c].height,q={};return"height"===a?(q.height=j*h-m>>0,q.width=o*q.height/p-n>>0):"width"===a?(q.width=k*h-n>>0,q.height=p*q.width/o-m>>0):"none"===a&&(q.width=o+n-n>>0,q.height=p+m-m>>0),"image"===b&&(q.height=q.height.toString()+"px",q.width=q.width.toString()+"px"),q},b.loadImage=function(){var a,b,e,g,h=this.getImageIndex(),i=d.params,j=function(a){var b,c=d.options,e=d.consts,g=e.SINGLE_MODE,h=i.storage_hash+g,j=h+"_width",k=h+"_height";i.image_sizes[g]={width:a.width,height:a.height},b=this.getSizesAutofit_(c.screen_mode_params[g].autofit,"wrapper"),d.params.page_width=b.width,d.params.page_height=b.height,f.storage.set(j,b.width).set(k,b.height).set(i.hash_images_sizes,i.image_sizes)}.bind(this),k=function(){throw new Error("Error with image loading")},l=f.noop;for(0===h?(b=0,e=2):h===i.number_pages-1?(b=h-1,e=h):(b=h-1,e=h+1),a=b;e>=a;a++)g=i.loaded_images.page.indexOf(a),-1===g&&function(a){var b=function(b){var c=b.target;(null===i.page_width||null===i.page_height)&&j(c),this.createPage_(c,a),d.params.loaded_images.img.push(c),d.params.loaded_images.page.push(a)}.bind(this);new c(this.getImage(a),b,k,l).start()}.bind(this)(a);return this},b.getImageIndex=function(a){var b=a||d.params.current_page;return b-1>>0}}(this),function(a){"use strict";var b=a.EBookReader,c=a.JEZ;b.HTMLReader=function(){b.Reader.call(this)},c.inherits(b.HTMLReader,b.Reader)}(this);